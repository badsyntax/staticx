#!/usr/bin/env node

/*
 * staticx
 * https://github.com/badsyntax/staticx
 *
 * Copyright (c) 2013 Richard Willis
 * Licensed under the MIT license.
 */

'use strict';

var staticx = require('../lib/staticx');
var program = require('commander');
var pkg = require('../package');
var colors = require('colors');
var path = require('path');

function exit(code, message) {
  console.log(String(message)[[
    'info',
    'error'
  ][code]]);
  process.exit(code);
}

function create(destination, options){

  var start = new Date();

  staticx.create({
    dest: destination,
    posts: options.posts,
    clean: options.clean
  }, function(err) {

    var end = new Date();

    if (err) {
      exit(1, err);
    }
    else {
      var msg = 'Successfully created a new site at: ' + path.resolve(destination);
      msg += ('\nCompleted in ' + (end - start) + 'ms').data;
      exit(0, msg);
    }
  });
};

colors.setTheme({
  error: 'red',
  info: 'green',
  data: 'grey'
});

program
  .version(pkg.version);

program
  .command('create <destination>')
  .description('create a new site')
  .option('-p, --posts <posts>', 'number of dummy blog posts to generate', parseInt)
  .option('-c, --clean', 'clean the destination folder before creating', parseInt)
  .action(create);

program.parse(process.argv);
